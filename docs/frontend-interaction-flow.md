# PDF标签生成系统 - 用户交互流程文档

## 1. 系统概述

本系统用于根据Excel游戏数据生成游戏卡片的盒标和箱标PDF文件，支持不同的包装模式和标签呈现效果。

## 2. 完整交互流程

```
开始
├── 步骤1: 上传Excel文件
│   └── 用户选择包含游戏数据的Excel文件
├── 步骤2: 选择包装模式
│   ├── 常规模式（单级编号）
│   ├── 分盒模式（多级编号）
│   └── 套盒模式（多级编号）
├── 步骤3: 输入包装参数
│   ├── 每盒张数 (sheets_per_box) [所有模式必填]
│   ├── 每小箱盒数 (boxes_per_small_case) [分盒/套盒模式必填]
│   └── 每大箱小箱数 (small_cases_per_large_case) [分盒/套盒模式必填]
├── 步骤4: 选择盒标呈现效果
│   ├── Regular模板 (客户编码+主题+序列号)
│   └── Game模板 (Game title + Ticket count + Serial)
└── 步骤5: 生成PDF
    ├── 自动生成盒标和箱标
    ├── 按PDF/X格式输出
    └── 文件结构：{客户名称}+{订单名称}+标签/
        ├── {客户名称}+{订单名称}+盒标.pdf
        └── {客户名称}+{订单名称}+箱标.pdf
```

## 3. 详细步骤说明

### 步骤1: 上传Excel文件
- **操作**: 用户通过文件选择器上传Excel文件
- **验证**: 检查文件格式(.xlsx)和必要的数据字段
- **提取数据**: 
  - A3: 客户名称编码 (customer_code)
  - B3: 主题 (theme)
  - B10: 开始号 (start_number)  
  - F3: 总张数 (total_sheets)

### 步骤2: 选择包装模式
- **常规模式**: 单级编号，适用于简单包装
- **分盒模式**: 多级编号，适用于分盒包装
- **套盒模式**: 多级编号，适用于套装包装

### 步骤3: 输入包装参数
- **每盒张数**: 每个盒子包含的卡片数量
- **每小箱盒数**: 每个小箱包含的盒子数量（分盒/套盒模式）
- **每大箱小箱数**: 每个大箱包含的小箱数量（分盒/套盒模式）

### 步骤4: 选择盒标呈现效果
- **Regular模板**: 
  - 首页: 客户编码 + 主题
  - 其他页: 主题 + 序列号
- **Game模板**: 
  - 每页: Game title + Ticket count + Serial number

### 步骤5: 生成PDF
- **自动生成**: 同时生成盒标和箱标PDF
- **文件格式**: PDF/X（适用于CMYK打印）
- **文件命名**: 基于Excel中的客户名称和订单名称

## 4. 模式对应关系

| 包装模式 | 盒标级数 | 箱标模板 | 参数要求 | 序列号示例 |
|---------|---------|---------|---------|-----------|
| 常规模式 | 单级 | regular_single | 仅需每盒张数 | JAW01001 |
| 分盒模式 | 多级 | multi_separate | 需要全部参数 | JAW01001-01 |
| 套盒模式 | 多级 | multi_set | 需要全部参数 | JAW01001-01 |

## 5. 输出格式要求

### 文件结构
```
{客户名称}+{订单名称}+标签/
├── {客户名称}+{订单名称}+盒标.pdf
└── {客户名称}+{订单名称}+箱标.pdf
```

### 示例输出
```
14KH0095+JAWS+标签/
├── 14KH0095+JAWS+盒标.pdf
└── 14KH0095+JAWS+箱标.pdf
```

### PDF格式规范
- **颜色模式**: CMYK
- **格式标准**: PDF/X-1a 或 PDF/X-3
- **页面尺寸**: 90mm × 50mm
- **分辨率**: 300 DPI

## 6. 用户体验要求

### 界面设计原则
- **步骤清晰**: 明确的进度指示
- **参数验证**: 实时输入验证和错误提示
- **智能默认**: 根据模式自动设置合理默认值
- **预览功能**: 生成前可预览配置信息

### 错误处理
- **文件格式错误**: 提示用户上传正确的Excel文件
- **数据缺失**: 指出Excel中缺失的必要字段
- **参数无效**: 实时验证数值范围和逻辑合理性
- **生成失败**: 提供详细的错误信息和解决建议

## 7. 技术实现要点

### 数据流转
```
Excel文件 → 数据提取 → 参数配置 → 模板选择 → PDF生成 → 文件输出
```

### 关键算法
- **盒数计算**: math.ceil(total_cards / cards_per_box)
- **序列号生成**: 支持单级和多级编号格式
- **文件名生成**: 基于Excel数据的智能命名